<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora de Lucro/Venda</title>
  
  <!-- Bootstrap CSS -->
  <link href="assets/bootstrap.min.css" rel="stylesheet">
  
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="assets/bootstrap-icons.min.css">

</head>
<body>

<div class="container">

  <h2 class="text-center mt-4 mb-4"><i class="bi bi-calculator"></i> Calculadora de Lucro/Venda</h2>

  <div class="row">
    <div class="col-sm mb-3">
      <label class="form-label" for="custoUnitario">Custo Unitário:</label>
      <input type="number" class="form-control" id="custoUnitario" step="any" placeholder="Ex: 10.00">
    </div>
    <div class="col-sm mb-3">
      <label class="form-label" for="unidades">Quantidade de Unidades:</label>
      <input type="number" class="form-control" id="unidades" step="any" placeholder="Ex: 100">
    </div>
  </div>

  <div class="row">
    <div class="col-sm mb-3">
      <label class="form-label" for="taxaPercentual">Taxa Percentual (%):</label>
      <input type="number" class="form-control" id="taxaPercentual" step="any" value="20">
    </div>

    <div class="col-sm mb-3">
      <label class="form-label" for="taxaFixa">Taxa Fixa:</label>
      <input type="number" class="form-control" id="taxaFixa" step="any" value="4">
    </div>
  </div>

  <div class="mb-3">
    <label class="form-label" for="operation">Escolha a operação:</label>
    <select class="form-select" id="operation">
      <option value="" disabled selected>...</option>
      <option value="lucro">Calcular Lucro (informar Preço de Venda Total)</option>
      <option value="venda">Calcular Preço de Venda (informar Lucro Desejado por Unidade)</option>
      <option value="vendaMarkup">Calcular Preço de Venda (informar % de Markup Desejado)</option>
      <option value="vendaPercentual">Calcular Preço de Venda (informar % de Lucro Desejado)</option>
    </select>
  </div>

  <div class="mb-3" id="vendaField">
    <label class="form-label" for="valorVenda">Preço de Venda Total:</label>
    <input type="number" class="form-control" id="valorVenda" step="any">
  </div>

  <div class="mb-3" id="lucroField" style="display: none;">
    <label class="form-label" for="lucroDesejado">Lucro Desejado por Unidade:</label>
    <input type="number" class="form-control" id="lucroDesejado" step="any">
  </div>

  <div class="mb-3" id="lucroPercentualField" style="display: none;">
    <label class="form-label" for="lucroPercentual">Lucro Desejado (%):</label>
    <input type="number" class="form-control" id="lucroPercentual" step="any">
  </div>

  <div class="mb-3" id="markupField" style="display: none;">
    <label class="form-label" for="markupDesejado">Markup Desejado (%):</label>
    <input type="number" class="form-control" id="markupDesejado" step="any">
  </div>


  <div class="row-sm">
    <div class="col">
      <button class="btn btn-primary w-100" onclick="calcular()">
        <i class="fas fa-calculator"></i> Calcular
      </button>
    </div>
    <div class="col">
      <button class="btn btn-success w-100 mt-sm-2" onclick="sugerirPrecoIdeal()">
        <i class="bi bi-lightbulb"></i> Sugerir Preço Ideal (mín. 30% de margem)
      </button>
    </div>
  </div>


  <h3 class="text-center mt-4">Resultado:</h3>
  <div class="row">
    <div class="col">
      <div id="resultado"></div>
    </div>
    <div class="col">
      <canvas id="graficoLucro" style="max-width: 600px; margin: 40px auto;"></canvas>
    </div>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="./assets/bootstrap.min.js"></script>
<script src="./assets/chart.js"></script>


<script>
  document.getElementById("operation").addEventListener("change", function () {
    document.getElementById("vendaField").style.display = this.value === "lucro" ? "block" : "none";
    document.getElementById("lucroField").style.display = this.value === "venda" ? "block" : "none";
    document.getElementById("lucroPercentualField").style.display = this.value === "vendaPercentual" ? "block" : "none";
    document.getElementById("markupField").style.display = this.value === "vendaMarkup" ? "block" : "none";
  });

  function avisoLucro(margem) {
    if (margem < 15) {
      return `<p style="color: red;"><strong>Lucro muito baixo! (abaixo de 15%)</strong></p>`;
    } else if (margem < 20){
      return `<p style="color: orange;"><strong>Lucro baixo! (abaixo de 20%)</strong></p>`;
    } else if (margem < 25) {
      return `<p style="color: orange;"><strong>Lucro aceitável.</strong></p>`;
    } else {
      return `<p style="color: green;"><strong>Boa margem de lucro!</strong></p>`;
    }
  }

  function calcular() {
    const custoUnitario = parseFloat(document.getElementById("custoUnitario").value) || 0;
    const unidades = parseFloat(document.getElementById("unidades").value) || 0;
    const custoTotal = custoUnitario * unidades;
    const taxaPercentual = parseFloat(document.getElementById("taxaPercentual").value) || 0;
    const taxaFixa = parseFloat(document.getElementById("taxaFixa").value) || 0;
    const op = document.getElementById("operation").value;
    const resultadoDiv = document.getElementById("resultado");
    resultadoDiv.innerHTML = "";
    resultadoDiv.style.display = "block";
    const tetoTaxa = 100;

    if (!custoUnitario || !unidades) return;

    if (op === "lucro") {
      const valorVendaTotal = parseFloat(document.getElementById("valorVenda").value);
      if (!valorVendaTotal) return;

      const taxaAplicada = Math.min(valorVendaTotal * (taxaPercentual / 100), tetoTaxa);
      const totalTaxas = taxaAplicada + taxaFixa;
      const lucroTotal = valorVendaTotal - custoTotal - totalTaxas;
      const lucroPorUnidade = lucroTotal / unidades;
      const margemLucro = (lucroTotal / valorVendaTotal) * 100;
      const markup = (lucroTotal / custoTotal) * 100;

      resultadoDiv.innerHTML = `
        <p><strong>Lucro Total:</strong> R$ ${lucroTotal.toFixed(2)}</p>
        <p><strong>Lucro por Unidade:</strong> R$ ${lucroPorUnidade.toFixed(2)}</p>
        <p><strong>Total de Taxas:</strong> R$ ${totalTaxas.toFixed(2)}</p>
        <p><strong>Margem de Lucro:</strong> ${margemLucro.toFixed(2)}%</p>
        <p><strong>Markup:</strong> ${markup.toFixed(2)}%</p>
        ${avisoLucro(margemLucro)}
      `;
      atualizarGrafico(custoTotal, totalTaxas, lucroTotal);

    }

    else if (op === "venda") {
      const lucroDesejado = parseFloat(document.getElementById("lucroDesejado").value) || 0;
      const lucroTotalDesejado = lucroDesejado * unidades;
      const valorEstimado = (custoTotal + lucroTotalDesejado + taxaFixa) / (1 - taxaPercentual / 100);
      const taxaAplicada = valorEstimado * (taxaPercentual / 100);
      const valorVendaTotal = (taxaAplicada > tetoTaxa)
        ? custoTotal + lucroTotalDesejado + taxaFixa + tetoTaxa
        : valorEstimado;
      const taxaFinal = Math.min(valorVendaTotal * (taxaPercentual / 100), tetoTaxa);
      const totalTaxas = taxaFinal + taxaFixa;

      const margem = (lucroTotalDesejado / valorVendaTotal) * 100;
      const markup = (lucroTotalDesejado / custoTotal) * 100;

      resultadoDiv.innerHTML = `
        <p><strong>Preço de Venda Total:</strong> R$ ${valorVendaTotal.toFixed(2)}</p>
        <p><strong>Total de Taxas:</strong> R$ ${totalTaxas.toFixed(2)}</p>
        <p><strong>Margem de Lucro:</strong> ${margem.toFixed(2)}%</p>
        <p><strong>Markup:</strong> ${markup.toFixed(2)}%</p>
        ${avisoLucro(margem)}
      `;
      atualizarGrafico(custoTotal, totalTaxas, lucroTotalDesejado);
    }

    else if (op === "vendaPercentual") {
      const lucroPercentual = parseFloat(document.getElementById("lucroPercentual").value) || 0;
      const valorEstimado = (custoTotal + taxaFixa) / (1 - (taxaPercentual + lucroPercentual) / 100);
      const taxaAplicada = valorEstimado * (taxaPercentual / 100);
      const valorVendaTotal = (taxaAplicada > tetoTaxa)
        ? (custoTotal + taxaFixa + tetoTaxa) / (1 - lucroPercentual / 100)
        : valorEstimado;

      const taxaFinal = Math.min(valorVendaTotal * (taxaPercentual / 100), tetoTaxa);
      const totalTaxas = taxaFinal + taxaFixa;
      const lucroTotal = valorVendaTotal - custoTotal - totalTaxas;
      const markup = (lucroTotal / custoTotal) * 100;

      resultadoDiv.innerHTML = `
        <p><strong>Preço de Venda Total:</strong> R$ ${valorVendaTotal.toFixed(2)}</p>
        <p><strong>Lucro Total:</strong> R$ ${lucroTotal.toFixed(2)}</p>
        <p><strong>Total de Taxas:</strong> R$ ${totalTaxas.toFixed(2)}</p>
        <p><strong>Margem de Lucro:</strong> ${lucroPercentual.toFixed(2)}%</p>
        <p><strong>Markup:</strong> ${markup.toFixed(2)}%</p>
        ${avisoLucro(lucroPercentual)}
      `;
      atualizarGrafico(custoTotal, totalTaxas, lucroTotal);
    }

    else if (op === "vendaMarkup") {
      const markupPercentual = parseFloat(document.getElementById("markupDesejado").value) || 0;
      const lucroDesejado = custoTotal * (markupPercentual / 100);
      const valorEstimado = (custoTotal + lucroDesejado + taxaFixa) / (1 - taxaPercentual / 100);
      const taxaAplicada = valorEstimado * (taxaPercentual / 100);
      const valorVendaTotal = (taxaAplicada > tetoTaxa)
        ? custoTotal + lucroDesejado + taxaFixa + tetoTaxa
        : valorEstimado;
      const taxaFinal = Math.min(valorVendaTotal * (taxaPercentual / 100), tetoTaxa);
      const totalTaxas = taxaFinal + taxaFixa;

      const margem = (lucroDesejado / valorVendaTotal) * 100;

      resultadoDiv.innerHTML = `
        <p><strong>Preço de Venda Total:</strong> R$ ${valorVendaTotal.toFixed(2)}</p>
        <p><strong>Lucro Total:</strong> R$ ${lucroDesejado.toFixed(2)}</p>
        <p><strong>Total de Taxas:</strong> R$ ${totalTaxas.toFixed(2)}</p>
        <p><strong>Markup Desejado:</strong> ${markupPercentual.toFixed(2)}%</p>
        <p><strong>Margem de Lucro:</strong> ${margem.toFixed(2)}%</p>
        ${avisoLucro(margem)}
      `;
      atualizarGrafico(custoTotal, totalTaxas, lucroDesejado);
    }
  }


  function sugerirPrecoIdeal() {
    const custoUnitario = parseFloat(document.getElementById("custoUnitario").value) || 0;
    const unidades = parseFloat(document.getElementById("unidades").value) || 0;
    const custoTotal = custoUnitario * unidades;
    const taxaPercentual = parseFloat(document.getElementById("taxaPercentual").value) || 0;
    const taxaFixa = parseFloat(document.getElementById("taxaFixa").value) || 0;
    const resultadoDiv = document.getElementById("resultado");
    resultadoDiv.innerHTML = "";
    resultadoDiv.style.display = "block";

    const margemDesejada = 0.25; // 25%
    const tetoTaxa = 100;

    if (!custoUnitario || !unidades) return;

    // Primeiro tenta calcular normalmente
    let estimativa = (custoTotal + taxaFixa) / (1 - margemDesejada - (taxaPercentual / 100));
    let taxaAplicada = estimativa * (taxaPercentual / 100);

    let precoFinal = 0;
    if (taxaAplicada > tetoTaxa) {
      precoFinal = (custoTotal + taxaFixa + tetoTaxa) / (1 - margemDesejada);
      taxaAplicada = tetoTaxa;
    } else {
      precoFinal = estimativa;
    }

    const totalTaxas = taxaAplicada + taxaFixa;
    const lucroTotal = precoFinal - custoTotal - totalTaxas;
    const lucroUnidade = lucroTotal / unidades;
    const markup = (lucroTotal / custoTotal) * 100;

    resultadoDiv.innerHTML = `
      <p><strong>Preço de Venda Ideal:</strong> R$ ${precoFinal.toFixed(2)}</p>
      <p><strong>Lucro Total:</strong> R$ ${lucroTotal.toFixed(2)}</p>
      <p><strong>Lucro por Unidade:</strong> R$ ${lucroUnidade.toFixed(2)}</p>
      <p><strong>Total de Taxas:</strong> R$ ${totalTaxas.toFixed(2)}</p>
      <p><strong>Margem de Lucro:</strong> ${(margemDesejada * 100).toFixed(2)}%</p>
      <p><strong>Markup:</strong> ${markup.toFixed(2)}%</p>
      <p style="color: green;"><strong>Esse é o menor valor que garante 25% de lucro.</strong></p>
    `;

    atualizarGrafico(custoTotal, totalTaxas, lucroTotal);
  }



  let graficoAtual = null;

  function atualizarGrafico(custo, taxas, lucro) {
    const ctx = document.getElementById('graficoLucro').getContext('2d');
    if (graficoAtual) graficoAtual.destroy(); // Remove gráfico anterior, se houver

    graficoAtual = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Custo', 'Taxas', 'Lucro'],
        datasets: [{
          label: 'Composição do Preço de Venda',
          data: [custo, taxas, lucro],
          backgroundColor: ['#0d6efd', '#ffc107', '#198754'] // azul, amarelo, verde
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false },
          tooltip: { callbacks: {
            label: ctx => `R$ ${ctx.raw.toFixed(2)}`
          }}
        },
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              callback: value => `R$ ${value}`
            }
          }
        }
      }
    });
  } 


</script>


</body>
</html>